<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RAILS - Complete Logic Generalization Plan</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        background: #f8f9fa;
        color: #1a1a2e;
        line-height: 1.65;
        padding: 1.8rem;
        max-width: 980px;
        margin: 0 auto;
    }
    .back-link {
        display: inline-block;
        margin-bottom: 0.9rem;
        color: #2563eb;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
    }
    h1 {
        font-size: 1.85rem;
        color: #16213e;
        margin-bottom: 0.25rem;
    }
    .subtitle {
        color: #556070;
        font-size: 0.95rem;
        margin-bottom: 1.2rem;
    }
    .card {
        background: #fff;
        border-radius: 12px;
        padding: 1rem 1.1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        margin-bottom: 0.9rem;
    }
    h2 {
        font-size: 1.08rem;
        color: #16213e;
        margin-bottom: 0.55rem;
    }
    ul, ol {
        margin-left: 1.15rem;
        color: #374151;
        font-size: 0.9rem;
    }
    li { margin-bottom: 0.28rem; }
    .pill-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.55rem;
        margin-top: 0.45rem;
    }
    .pill {
        border-radius: 999px;
        padding: 0.22rem 0.58rem;
        font-size: 0.75rem;
        font-weight: 700;
    }
    .p-blue { background: #dbeafe; color: #1d4ed8; }
    .p-green { background: #dcfce7; color: #166534; }
    .p-amber { background: #fef3c7; color: #92400e; }
    .p-purple { background: #f3e8ff; color: #6b21a8; }
    .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 0.55rem;
        margin-top: 0.5rem;
    }
    .metric {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 0.55rem;
        text-align: center;
    }
    .metric .v {
        font-size: 1.15rem;
        font-weight: 800;
        color: #2563eb;
    }
    .metric .k {
        font-size: 0.72rem;
        color: #64748b;
        margin-top: 0.1rem;
    }
    code {
        background: #eef2ff;
        color: #3730a3;
        border-radius: 4px;
        padding: 0.05rem 0.32rem;
        font-size: 0.82rem;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.86rem;
        margin-top: 0.4rem;
    }
    th, td {
        border: 1px solid #e2e8f0;
        text-align: left;
        vertical-align: top;
        padding: 0.48rem;
    }
    th {
        background: #f1f5f9;
        color: #0f172a;
        font-weight: 700;
    }
    .small { font-size: 0.82rem; color: #64748b; }
</style>
</head>
<body>
<a class="back-link" href="index.html">&larr; Back to Hub</a>
<h1>Complete Logic Generalization Plan</h1>
<p class="subtitle">Updated strategy for Paper 1 (logic focus): axes-complete coverage, strict symbolic quality, and transfer-first evaluation.</p>

<div class="card">
    <h2>Objective</h2>
    <p style="font-size:0.92rem; color:#374151;">
        Build a model that learns robust logical reasoning from strict formal traces and
        transfers to natural-language logic benchmarks (FOLIO, ProofWriter, ProntoQA),
        without leakage or benchmark overfitting.
    </p>
    <div class="pill-row">
        <span class="pill p-blue">All LogicBench Types</span>
        <span class="pill p-blue">Axes Coverage Matrix</span>
        <span class="pill p-green">Strict Verification</span>
        <span class="pill p-amber">Bridge to Natural Language</span>
        <span class="pill p-purple">SFT Then GRPO</span>
    </div>
</div>

<div class="card">
    <h2>Two-Track Data Strategy</h2>
    <ol>
        <li><code>strict_core</code>: exact formal reasoning with strict chain validation.</li>
        <li><code>rich_noise</code>: strict chains plus distractors to prevent shortcut reliance.</li>
        <li><code>bridge_nl</code>: same formal proof graph realized in diverse natural language.</li>
        <li>All training examples keep <code>&lt;think&gt;</code> with intermediate reasoning text and formal <code>&lt;step&gt;</code> blocks.</li>
    </ol>
</div>

<div class="card">
    <h2>Axes Coverage Matrix (must be complete)</h2>
    <table>
        <thead>
            <tr>
                <th>Axis</th>
                <th>Coverage Bins</th>
                <th>Quota Policy</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>Inference family</td><td>All 25 LogicBench(Aug) theory types</td><td>Equal count per type</td></tr>
            <tr><td>Chain depth</td><td>3-5, 6-9, 10-14, 15-20</td><td>Minimum quota per bin</td></tr>
            <tr><td>Label</td><td>True / False / Unknown</td><td>Balanced globally and per-type</td></tr>
            <tr><td>Lexical style</td><td>Canonical, plain NL, rich NL</td><td>Balanced within each depth band</td></tr>
            <tr><td>Negation profile</td><td>None, single, multi-negation</td><td>Minimum support per type</td></tr>
            <tr><td>Entity structure</td><td>Single entity, multi-entity, cross-entity</td><td>Minimum support per type</td></tr>
            <tr><td>Distractor pressure</td><td>Low, medium, high noise</td><td>Fixed ratio per split</td></tr>
            <tr><td>Uncertainty regime</td><td>Deterministic, partial conflict, unknown-heavy</td><td>Balanced across training stages</td></tr>
        </tbody>
    </table>
    <p class="small">Generation stops only when all bins satisfy quota. Under-covered bins are regenerated.</p>
</div>

<div class="card">
    <h2>Equal-Type Requirement</h2>
    <ul>
        <li>LogicBench(Aug) has 25 theory types total (8 propositional, 9 FOL, 8 non-monotonic).</li>
        <li>For a 50K logic-focused release: target <code>2,000</code> examples per theory type.</li>
        <li>Within each type, maintain near-balanced <code>True / False / Unknown</code>.</li>
        <li>Primitive rule mix (MP/DS/MT/etc.) is monitored and corrected by quota-based sampling.</li>
    </ul>
</div>

<div class="card">
    <h2>SFT vs GRPO Data Protocol</h2>
    <ol>
        <li>Use disjoint splits: <strong>no prompt overlap</strong> between SFT and GRPO training sets.</li>
        <li><strong>SFT:</strong> full supervision on completion traces to teach stable format and formal steps.</li>
        <li><strong>GRPO:</strong> optimize generated traces with reward for correctness + formal consistency + format validity.</li>
        <li>GRPO set emphasizes harder axes bins (longer chains, richer language, uncertainty cases).</li>
    </ol>
</div>

<div class="card">
    <h2>Leakage and Validity Gates</h2>
    <ol>
        <li>No answer leakage in <code>user_prompt</code> before and after truncation.</li>
        <li>Parser-valid trace required: balanced <code>&lt;step&gt;</code> tags, valid references, final answer present.</li>
        <li>Logical validity required: strict-chain depth checks and symbolic consistency checks.</li>
        <li>Dedup required: exact, normalized, and near-duplicate checks.</li>
        <li>Any sample failing gates is dropped.</li>
    </ol>
</div>

<div class="card">
    <h2>Training Curriculum</h2>
    <ol>
        <li>Stage 1: SFT on strict-core-heavy data to lock in reasoning format.</li>
        <li>Stage 2: SFT mix-in of bridge natural-language variants.</li>
        <li>Stage 3: GRPO on disjoint hard split with verifier-aligned reward.</li>
        <li>Reward components: answer correctness, formal consistency, step format, truncation control.</li>
    </ol>
</div>

<div class="card">
    <h2>Generalization Evaluation Gates</h2>
    <ol>
        <li>Internal holdout by axis bins (depth/style/negation/uncertainty).</li>
        <li>External untouched transfer: FOLIO, ProofWriter, ProntoQA.</li>
        <li>Ablations: strict-only vs strict+bridge, balanced vs unbalanced type sampling, short vs long-chain.</li>
        <li>Go/no-go criterion: strict+bridge must outperform strict-only on external transfer with no consistency regression.</li>
    </ol>
</div>

<div class="card">
    <h2>Execution Targets</h2>
    <div class="metrics">
        <div class="metric"><div class="v">50K</div><div class="k">Logic Set (Current)</div></div>
        <div class="metric"><div class="v">25</div><div class="k">Theory Types</div></div>
        <div class="metric"><div class="v">20</div><div class="k">Max Hop Target</div></div>
        <div class="metric"><div class="v">0</div><div class="k">Leakage Tolerance</div></div>
    </div>
    <p class="small" style="margin-top:0.55rem;">
        Related pages:
        <a href="logicbench_compositional_examples.html">Compositional Examples</a> ·
        <a href="grpo_prompt_spec.html">GRPO Prompt Spec</a> ·
        <a href="project_status.html">Project Status</a>
    </p>
</div>
</body>
</html>
